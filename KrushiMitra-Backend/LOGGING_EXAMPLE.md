# Structured Logging Examples

This document provides examples of the structured logs generated by the KrushiMitra backend.

## Log File Structure

### Combined Log (`combined.log`)
Contains all application logs in structured JSON format:

```json
{
  "timestamp": "2025-09-17 23:00:00",
  "level": "info",
  "message": "Database operation executed",
  "service": "krushimitra-db",
  "operation": "find",
  "farmerId": "test_farmer_123",
  "collection": "farmers",
  "durationMs": 50,
  "status": "success"
}
```

```json
{
  "timestamp": "2025-09-17 23:00:00",
  "level": "error",
  "message": "Database operation failed",
  "stack": "Error: Test file error\n    at Object.<anonymous> (c:\\Users\\Dhairyashil\\Downloads\\SIH_APP-main\\SIH_APP-main\\backend\\simple-log-test.js:12:19)\n    at Module._compile (node:internal/modules/cjs/loader:1554:14)\n    at Object..js (node:internal/modules/cjs/loader:1706:10)\n    at Module.load (node:internal/modules/cjs/loader:1289:32)\n    at Function._load (node:internal/modules/cjs/loader:1108:12)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:170:5)\n    at node:internal/main/run_main_module:36:49",
  "service": "krushimitra-db",
  "operation": "insert",
  "error": "Test file error",
  "farmerId": "test_farmer_456",
  "collection": "activities",
  "durationMs": 100
}
```

### Database Log (`database.log`)
Contains only database-specific operations:

```json
{
  "timestamp": "2025-09-17 23:00:00",
  "level": "info",
  "message": "Database operation executed",
  "service": "krushimitra-db",
  "operation": "find",
  "farmerId": "test_farmer_123",
  "collection": "farmers",
  "durationMs": 50,
  "status": "success"
}
```

### Error Log (`error.log`)
Contains only error logs with full stack traces:

```json
{
  "timestamp": "2025-09-17 23:00:00",
  "level": "error",
  "message": "Database operation failed",
  "stack": "Error: Test file error\n    at Object.<anonymous> (c:\\Users\\Dhairyashil\\Downloads\\SIH_APP-main\\SIH_APP-main\\backend\\simple-log-test.js:12:19)\n    at Module._compile (node:internal/modules/cjs/loader:1554:14)\n    at Object..js (node:internal/modules/cjs/loader:1706:10)\n    at Module.load (node:internal/modules/cjs/loader:1289:32)\n    at Function._load (node:internal/modules/cjs/loader:1108:12)\n    at TracingChannel.traceSync (node:diagnostics_channel:322:14)\n    at wrapModuleLoad (node:internal/modules/cjs/loader:220:24)\n    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:170:5)\n    at node:internal/main/run_main_module:36:49",
  "service": "krushimitra-db",
  "operation": "insert",
  "error": "Test file error",
  "farmerId": "test_farmer_456",
  "collection": "activities",
  "durationMs": 100
}
```

## Example Log Entries from Application Operations

### Farmer Profile Creation/Update
```json
{
  "timestamp": "2025-09-17 22:45:30",
  "level": "info",
  "message": "Database operation executed",
  "service": "krushimitra-db",
  "operation": "upsertFarmer",
  "farmerId": "+919876543210",
  "durationMs": 120,
  "status": "success"
}
```

### Activity Logging
```json
{
  "timestamp": "2025-09-17 22:46:15",
  "level": "info",
  "message": "Database operation executed",
  "service": "krushimitra-db",
  "operation": "insertActivity",
  "farmerId": "farmer_abc123",
  "activityType": "field_visit",
  "activityId": "activity_xyz789",
  "durationMs": 85,
  "status": "success"
}
```

### Mandi Price Retrieval
```json
{
  "timestamp": "2025-09-17 22:47:22",
  "level": "info",
  "message": "Database operation executed",
  "service": "krushimitra-db",
  "operation": "findMandiPrices",
  "crop": "Wheat",
  "location": "Pune",
  "returned": 5,
  "durationMs": 65,
  "status": "success"
}
```

### Database Connection
```json
{
  "timestamp": "2025-09-17 22:30:00",
  "level": "info",
  "message": "Database operation executed",
  "service": "krushimitra-db",
  "operation": "connect",
  "user": "reader",
  "operationType": "read",
  "durationMs": 230,
  "status": "success"
}
```

### Error Example
```json
{
  "timestamp": "2025-09-17 22:50:45",
  "level": "error",
  "message": "Database operation failed",
  "service": "krushimitra-db",
  "operation": "findFarmer",
  "farmerId": "+919999999999",
  "error": "Farmer not found",
  "durationMs": 45
}
```

## Benefits of Structured Logging

1. **Easy Parsing**: JSON format makes it easy to parse logs programmatically
2. **Rich Context**: Each log entry contains relevant context information
3. **Performance Monitoring**: Duration tracking helps identify slow operations
4. **Error Tracking**: Full stack traces for debugging
5. **Searchable**: Structured data can be easily searched and filtered
6. **Monitoring**: Compatible with log aggregation and monitoring tools

## Log Analysis Examples

### Find Slow Operations
```bash
# Find all operations that took longer than 100ms
grep '"durationMs":' logs/database.log | awk -F'durationMs":' '{if ($2 > 100) print $0}'
```

### Count Operations by Type
```bash
# Count successful operations by type
grep '"status":"success"' logs/database.log | grep -o '"operation":"[^"]*"' | sort | uniq -c
```

### Find Errors
```bash
# Find all error logs
grep '"level":"error"' logs/error.log
```

This structured logging approach provides comprehensive visibility into database operations while maintaining performance and scalability.